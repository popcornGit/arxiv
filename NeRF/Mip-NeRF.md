# Mip-NeRF: A Multiscale Representation for Anti-Aliasing Neural Radiance Fields
## Abstract
神经辐射场使用的渲染程序(NeRF)以每像素一束光线对场景进行采样，因此当训练或测试图像观察不同分辨率的场景内容时，可能会产生过度模糊或锯齿的渲染。

对于NeRF来说，通过每个像素渲染多条射线来实现超采样的直接解决方案是不切实际的，因为渲染每条射线需要查询多层感知器数百次。

我们的解决方案，我们称之为“mip-NeRF”，它扩展了NeRF在连续值尺度上表示场景。

mip-NeRF通过有效地渲染抗锯齿锥形截锥而不是射线，减少了令人反感的锯齿伪影，显著提高了NeRF表示精细细节的能力，同时也比NeRF快7%，尺寸减半。

与NeRF相比，mip-NeRF在NeRF数据集上降低了17%的平均错误率，在我们提出的数据集的具有挑战性的多尺度变体上降低了60%。

Mip-NeRF也能够在我们的多尺度数据集上与蛮力超采样NeRF的准确性相匹配，同时速度快22倍。

## Introduction
神经辐射场(NeRF)[30]等神经辐射表示已经成为一种引人注目的策略，用于学习从图像中表示3D物体和场景，以呈现逼真的新视图。

尽管NeRF及其变体在一系列视图合成任务中展示了令人印象深刻的结果，但NeRF的渲染模型在某种程度上存在缺陷，可能导致过度模糊和混叠。

NeRF用连续的体积函数取代了传统的离散采样几何，参数化为多层感知器(MLP)，从输入5D坐标(3D位置和2D观看方向)映射到该位置的场景属性(体积密度和依赖于视图的发射亮度)。

为了呈现一个像素的颜色，NeRF投射出一条穿过该像素的射线，并将其投射到它的体积表示中，查询MLP中沿该射线样本的场景属性，并将这些值合成为单一颜色。

虽然当所有训练和测试图像从一个大致恒定的距离观察场景内容时(就像在NeRF和大多数后续操作中所做的那样)，这种方法效果很好，NeRF渲染在不那么刻意的场景中展示了重要的工件。

当训练图像在多个分辨率下观察场景内容时，恢复的NeRF渲染图在近距离视图中显得过于模糊，并且在远景视图中包含混淆工件。

一个简单的解决方案是采用离线光线追踪中使用的策略:通过在其足迹中行进多条光线来对每个像素进行超采样。

但这对于神经体积表示(如NeRF)来说是非常昂贵的，它需要数百个MLP评估来呈现一条射线，并且需要几个小时来重建一个场景。

在本文中，我们从用于防止计算机图形渲染管道中混叠的mipmapping方法中获得灵感。

mipmap表示一组不同的离散下采样尺度上的信号(通常是图像或纹理映射)，并根据像素足迹在与光线相交的几何图形上的投影为光线选择适当的比例使用。

这种策略被称为预过滤，因为anti-aliasing的计算负担从渲染时间转移到预计算阶段(就像在暴力超采样解决方案中一样)—， 对于给定的纹理，mipmap只需创建一次，而不管该纹理渲染了多少次。

我们的解决方案，我们称之为mip-NeRF，扩展了NeRF，以同时表示连续尺度空间的预过滤辐射场。

mip-NeRF的输入是一个三维高斯分布，它表示亮度场应该被积分的区域。

如图1所示，我们可以通过沿着一个圆锥的间隔查询mip-NeRF来呈现一个预过滤的像素，使用高斯函数 将 锥形截锥 近似于 对应的 像素。

![image](https://user-images.githubusercontent.com/48575896/226780276-0fd802dd-c0ae-4d09-bbd7-4421ced30615.png)

为了编码三维位置及其周围的高斯区域，我们提出了一种新的特征表示:积分位置编码(IPE)。

这是NeRF位置编码(PE)的推广，它允许空间区域被紧凑地描述，而不是空间中的单个点。

Mip-NeRF大大提高了的准确性NeRF，场景内容在不同的分辨率观察下(即设置，相机移动到离场景或近或远)的情况下， 这种优势甚至更大。

在我们提出的具有挑战性的多分辨率基准上，mip-NeRF能够降低相对于的错误率NeRF平均降低60%(见图2)。

![image](https://user-images.githubusercontent.com/48575896/226781023-bde9ce3d-c041-48dc-a23d-e184fd6c10fe.png)

Mip-NeRF的尺度感知结构还允许我们将NeRF用于分层采样[30]的单独的“粗”和“细”MLP合并为单个MLP。

因此，mip-NeRF比NeRF略快(约7%)，并且有一半的参数。

## Method
正如所讨论的，NeRF的点采样使它容易受到与采样和混叠相关的问题:虽然像素的颜色是像素截体内所有入射亮度的集成，但NeRF在每个像素投射一个无穷小的窄射线，导致混叠。

MipNeRF通过从每个像素铸造一个锥体来改善这个问题。

我们没有沿着每条射线进行点采样，而是将被投射的圆锥划分为一系列锥形截锥(与轴垂直的圆锥切割)。

而不是从空间中无限小的点构建位置编码(PE)特征，我们构建了每个锥形截体覆盖的体积的积分位置编码(IPE)表示。

这些变化使MLP能够推断出每个圆锥形截锥的大小和形状，而不仅仅是它的质心。

由NeRF对尺度不敏感所导致的模糊性 和 mip-NeRF对该问题的解决方案 如图3所示。

![image](https://user-images.githubusercontent.com/48575896/226787056-d90ad600-81e8-413d-96d3-a2a704248032.png)

这种锥形锥台和IPE特征的使用也使我们减少NeRF将两个单独的“粗”和“细”MLP整合为一个多尺度MLP，提高了训练和评估速度，并将模型大小减少了50%。

### Cone Tracing and Positional Encoding
在这里，我们描述mip-NeRF的渲染和特征化过程，在这个过程中，我们铸造了一个锥体，并沿该锥体特征出锥形截锥。

与在NeRF中一样，mipNeRF中的图像一次呈现一个像素，因此我们可以根据所呈现的单个感兴趣像素来描述我们的过程。

对于该像素，我们从相机的投影中心o沿d方向投射一个圆锥，该圆锥穿过像素的中心。

该锥的顶点位于o，并且在像面o + d上的锥的半径参数化为r˙。

我们设r˙为像素在世界坐标中按缩放2/√12的宽度，它产生一个圆锥，其在图像平面上的部分在x和y上的方差与像素足迹的方差相匹配。

位于两个t值[t0, t1]之间的锥形截锥内的位置x的集合(如图1所示)为:

![image](https://user-images.githubusercontent.com/48575896/226792360-829c4424-ea6a-4fd8-9929-8ac516506753.png)

我们现在必须构造这个圆锥形截体内部体积的特征表示。理想情况下，这种特征表示应该与NeRF中使用的位置编码特征类似，Mildenhall等人表明这种特征表示对NeRF的成功至关重要[30]。有许多可行的方法(参见补充讨论)，但我们发现的最简单和最有效的解决方案是简单地计算锥体内所有坐标的期望位置编码:

![image](https://user-images.githubusercontent.com/48575896/226793365-6d053ba6-79a8-4d14-a8d1-8b1920a97bc9.png)

然而，目前还不清楚如何有效地计算这样一个特征，因为分子中的积分没有封闭形式的解。

因此，我们用多元高斯函数来近似圆锥截体，这允许有效地逼近所需的特征，我们将其称为“积分位置编码”(IPE)。

用多元函数近似圆锥体我们必须计算F (x，·)的均值和协方差。

因为每个圆锥截体都被假设为圆形，并且因为圆锥截体围绕锥轴对称，这样的高斯分布完全由三个值(除了o和d之外)表征:沿射线的平均距离µt，沿射线的方差![image](https://user-images.githubusercontent.com/48575896/226794956-4236aae4-d856-4fa5-8adb-76006bd784ca.png)，垂直于射线σ的方差![image](https://user-images.githubusercontent.com/48575896/226794942-e7ab57ae-0f1d-4fcf-9b9e-d395b98af334.png)：

![image](https://user-images.githubusercontent.com/48575896/226795161-0b29ce20-502b-4d81-93a4-062c4430bca2.png)

这些量是根据中点tµ= (t0 + t1)/2和半宽tδ = (t1−t0)/2进行参数化的，这对数值稳定性至关重要。详细的推导请参考补充。

我们可以对多元高斯函数从圆锥截锥的坐标坐标系转换到到世界坐标下:

![image](https://user-images.githubusercontent.com/48575896/226817759-97399341-24df-47b7-8463-8a2c71aec9a0.png)

得到最终的多元高斯函数。

接下来，我们推导出IPE，它是根据前面提到的高斯分布的位置编码坐标的期望。

为了实现这一点，首先将公式1中的PE重写为傅里叶特征[35,44]是有帮助的:

![image](https://user-images.githubusercontent.com/48575896/226818697-e42378c0-72ec-4a43-81d8-d6a965d12255.png)

![image](https://user-images.githubusercontent.com/48575896/226818726-f44fd318-1760-4714-9486-6e1f2da20213.png)

这种重新参数化允许我们推导出IPE的封闭形式。

利用一个变量的线性变换的协方差是变量协方差的线性变换这一事实![image](https://user-images.githubusercontent.com/48575896/226819319-b3433a2a-9eb2-4efd-b8bd-6895b3cd7cdc.png)当圆锥锥体高斯被提升到PE基P后，我们可以识别它的均值和协方差:

![image](https://user-images.githubusercontent.com/48575896/226819521-bc89e517-8616-4426-9c00-7c671a25f4b4.png)

生成IPE特征的最后一步是计算在这个提升的多元高斯上的期望，由位置的正弦和余弦调制。

这些期望有简单的封闭形式的表达式:

![image](https://user-images.githubusercontent.com/48575896/226819570-120d0353-5eef-4ce3-aa64-952b634d054c.png)

我们看到这个期望的正弦或余弦仅仅是均值的正弦或余弦乘以高斯函数的方差衰减。

有了这个，我们可以计算我们的最终IPE特征作为期望的正弦和余弦的平均值和协方差矩阵的对角线:

![image](https://user-images.githubusercontent.com/48575896/226824409-4175df11-b577-431f-b3a5-ce8bcda50dc7.png)

其中◦表示逐元素的乘法。

由于位置编码对每个维度进行独立编码，因此这种预期编码仅依赖于γ(x)的边际分布，并且仅依赖于协方差矩阵的对角线(每个维度方差的向量)。

因为Σγ由于其相对较大的尺寸，计算起来非常昂贵，我们直接计算Σγ的对角线:

![image](https://user-images.githubusercontent.com/48575896/226824574-f2413e7b-8154-4a79-a6ae-96dfd662584d.png)
