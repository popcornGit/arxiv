# DETRs Beat YOLOs on Real-time Object Detection

最近，基于Transformer的端到端检测器（DETR）已经取得了显著的性能。

然而，DETR的高计算成本问题尚未得到有效解决，这限制了它们的实际应用，并使它们无法充分利用无后处理的好处，如非最大值抑制（NMS）。

本文首先分析了现代实时目标检测器中NMS对推理速度的影响，并建立了端到端的速度基准。

为了避免NMS引起的推理延迟，作者提出了一种实时检测Transformer（RT-DETR），这是第一个实时端到端目标检测器。

具体而言，设计了一种高效的混合编码器，通过解耦尺度内交互和跨尺度融合来高效处理多尺度特征，并提出了IoU感知的查询选择，以提高目标查询的初始化。

此外，本文提出的检测器支持通过使用不同的解码器层来灵活调整推理速度，而不需要重新训练，这有助于实时目标检测器的实际应用。

RTDETR-L在COCO val2017上实现了53.0%的AP，在T4 GPU上实现了114 FPS，而RT-DETR-X实现了54.8%的AP和74 FPS，在速度和精度方面都优于相同规模的所有YOLO检测器。

此外，RTDETR-R50实现了53.1%的AP和108 FPS，在精度上比DINO-Deformable-DETR-R50高出2.2%的AP，在FPS上高出约21倍。

# 1、简介
目标检测是一项基本的视觉任务，涉及识别和定位图像中的目标。现代目标检测器有两种典型的体系结构：

a.基于CNN

b.基于Transformer

在过去的几年里，人们对基于CNN的目标检测器进行了广泛的研究。这些检测器的架构已经从最初的两阶段发展到一阶段，并且出现了两种检测范式，Anchor-Base和Anchor-Free。这些研究在检测速度和准确性方面都取得了重大进展。

基于Transformer的目标检测器（DETR）由于消除了各种手工设计的组件，如非最大值抑制（NMS），自提出以来，受到了学术界的广泛关注。该架构极大地简化了目标检测的流水线，实现了端到端的目标检测。

实时目标检测是一个重要的研究领域，具有广泛的应用，如目标跟踪、视频监控、自动驾驶等。现有的实时检测器通常采用基于CNN的架构，在检测速度和准确性方面实现了合理的权衡。然而，这些实时检测器通常需要NMS进行后处理，这通常难以优化并且不够鲁棒，导致检测器的推理速度延迟。

最近，由于研究人员在加速训练收敛和降低优化难度方面的努力，基于Transformer的检测器取得了显著的性能。然而，DETR的高计算成本问题尚未得到有效解决，这限制了DETR的实际应用，并导致无法充分利用其优势。这意味着，尽管简化了目标检测流水线，但由于模型本身的计算成本高，很难实现实时目标检测。

上述问题自然启发考虑是否可以将DETR扩展到实时场景，充分利用端到端检测器来避免NMS对实时检测器造成的延迟。为了实现上述目标，作者重新思考了DETR，并对其关键组件进行了详细的分析和实验，以减少不必要的计算冗余。

具体而言，作者发现，尽管多尺度特征的引入有利于加速训练收敛和提高性能，但它也会导致编码器中序列长度的显著增加。因此，由于计算成本高，Transformer编码器成为模型的计算瓶颈。为了实现实时目标检测，设计了一种高效的混合编码器来取代原来的Transformer编码器。通过解耦多尺度特征的尺度内交互和尺度间融合，编码器可以有效地处理不同尺度的特征。

此外，先前的工作表明，解码器的目标查询初始化方案对检测性能至关重要。为了进一步提高性能，作者提出了IoU-Aware的查询选择，它通过在训练期间提供IoU约束来向解码器提供更高质量的初始目标查询。

此外，作者提出的检测器支持通过使用不同的解码器层来灵活调整推理速度，而不需要重新训练，这得益于DETR架构中解码器的设计，并有助于实时检测器的实际应用。

本文提出了一种实时检测Transformer（RT-DETR），这是第一个实时基于Transformer的端到端目标检测器。RT-DETR不仅在精度和速度上优于目前最先进的实时检测器，而且不需要后处理，因此检测器的推理速度不会延迟并保持稳定，充分利用了端到端检测流水线的优势。

RT-DETR-L在COCO val2017上实现了53.0%的AP，在NVIDIA Tesla T4 GPU上实现了114 FPS，而RT-DETR-X实现了54.8%的AP和74 FPS，在速度和精度方面都优于相同规模的所有YOLO检测器。因此，RT-DETR成为了一种用于实时目标检测的新的SOTA，如图1所示。

![image](https://user-images.githubusercontent.com/48575896/233324126-8a239498-5181-48fb-a310-11ad4db8a09f.png)

此外，提出的RT-DETR-R50实现了53.1%的AP和108 FPS，而RT-DETR-R101实现了54.3%的AP和74 FPS。其中，RT-DETR50在准确度上优于DINO-Deformable-DETR-R50 2.2%的AP（53.1%的AP对50.9%的AP），在FPS（108 FPS对5 FPS）上优于DINO-Deformable-DETR-R5约21倍。

本文的主要贡献总结如下：

1.提出了第一个实时端到端目标检测器，它不仅在准确性和速度上优于当前的实时检测器，而且不需要后处理，因此推理速度不延迟，保持稳定；

2.详细分析了NMS对实时检测器的影响，并从后处理的角度得出了关于基于CNN的实时检测器的结论；

3.提出的IoU-Aware查询选择在我们的模型中显示出优异的性能改进，这为改进目标查询的初始化方案提供了新的线索；

4.本文的工作为端到端检测器的实时实现提供了一个可行的解决方案，并且所提出的检测器可以通过使用不同的解码器层来灵活地调整模型大小和推理速度，而不需要重新训练。
